<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System_VM_D62E - 管理后台</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #00f3ff;
            --secondary-color: #9400d3;
            --background-dark: #0a0a1a;
            --card-bg: rgba(30, 35, 60, 0.8);
            --sidebar-width: 250px;
            --header-height: 70px;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif; background: var(--background-dark); color: #e0e0e0; line-height: 1.6; }
        
        .admin-container { display: flex; min-height: 100vh; }
        
        .admin-sidebar { width: var(--sidebar-width); background: rgba(20, 25, 45, 0.95); border-right: 1px solid rgba(0, 243, 255, 0.2); position: fixed; height: 100vh; z-index: 100; overflow-y: auto; }
        .sidebar-header { padding: 20px; border-bottom: 1px solid rgba(0, 243, 255, 0.1); text-align: center; }
        .sidebar-logo { display: flex; align-items: center; justify-content: center; gap: 10px; color: var(--primary-color); font-size: 1.2rem; font-weight: bold; text-decoration: none; }
        .sidebar-logo img { width: 32px; height: 32px; border-radius: 50%; border: 1px solid rgba(0, 243, 255, 0.3); }
        .sidebar-nav { padding: 20px 0; }
        .nav-item { display: flex; align-items: center; gap: 12px; padding: 12px 20px; color: #a0a0a0; text-decoration: none; transition: all 0.3s ease; position: relative; }
        .nav-item:hover, .nav-item.active { background: rgba(0, 243, 255, 0.1); color: var(--primary-color); border-left: 3px solid var(--primary-color); }
        .sidebar-footer { padding: 20px; border-top: 1px solid rgba(0, 243, 255, 0.1); position: absolute; bottom: 0; left: 0; right: 0; }
        .user-profile { display: flex; align-items: center; gap: 10px; }
        .user-avatar { width: 40px; height: 40px; border-radius: 50%; border: 2px solid var(--primary-color); }
        .logout-btn { background: none; border: none; color: #ff3232; cursor: pointer; padding: 4px; transition: all 0.3s ease; }
        .logout-btn:hover { transform: scale(1.1); }
        
        .admin-main { flex: 1; margin-left: var(--sidebar-width); min-height: 100vh; }
        .admin-header { height: var(--header-height); background: rgba(30, 35, 60, 0.9); border-bottom: 1px solid rgba(0, 243, 255, 0.2); padding: 0 20px; display: flex; align-items: center; justify-content: space-between; position: sticky; top: 0; z-index: 90; }
        .menu-toggle { display: none; background: none; border: none; color: var(--primary-color); font-size: 1.2rem; cursor: pointer; padding: 8px; }
        .header-actions { display: flex; gap: 10px; }
        .action-btn { background: rgba(0, 243, 255, 0.1); border: 1px solid rgba(0, 243, 255, 0.3); color: var(--primary-color); padding: 8px 16px; border-radius: 4px; cursor: pointer; display: flex; align-items: center; gap: 6px; transition: all 0.3s ease; }
        .action-btn:hover { background: rgba(0, 243, 255, 0.2); }
        
        .admin-content { padding: 20px; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: var(--card-bg); border: 1px solid rgba(0, 243, 255, 0.15); border-radius: 10px; padding: 20px; transition: all 0.3s ease; }
        .stat-card:hover { transform: translateY(-5px); border-color: rgba(0, 243, 255, 0.3); box-shadow: 0 10px 20px rgba(0, 243, 255, 0.1); }
        .stat-value { font-size: 2rem; font-weight: bold; color: white; margin-bottom: 5px; }
        
        .chart-container { background: var(--card-bg); border: 1px solid rgba(0, 243, 255, 0.15); border-radius: 10px; padding: 20px; margin-bottom: 20px; }
        
        .table-container { background: var(--card-bg); border: 1px solid rgba(0, 243, 255, 0.15); border-radius: 10px; overflow: hidden; margin-bottom: 20px; }
        .admin-table { width: 100%; border-collapse: collapse; }
        .admin-table th { background: rgba(0, 0, 0, 0.2); color: #a0a0a0; padding: 15px 20px; text-align: left; }
        .admin-table td { padding: 15px 20px; border-bottom: 1px solid rgba(0, 243, 255, 0.05); }
        .admin-table tr:hover { background: rgba(0, 243, 255, 0.05); }
        .user-cell { display: flex; align-items: center; gap: 10px; }
        .user-avatar-sm { width: 32px; height: 32px; border-radius: 50%; border: 1px solid rgba(0, 243, 255, 0.3); }
        .status-badge { display: inline-block; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem; }
        .status-active { background: rgba(0, 255, 128, 0.1); color: #00ff80; }
        .status-inactive { background: rgba(255, 165, 0, 0.1); color: #ffa500; }
        .role-badge { display: inline-block; padding: 4px 8px; border-radius: 4px; background: rgba(0, 243, 255, 0.1); color: var(--primary-color); }
        .table-actions-cell { display: flex; gap: 8px; }
        .action-icon { width: 32px; height: 32px; border-radius: 4px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.3s ease; }
        .action-icon:hover { transform: scale(1.1); }
        .action-edit { background: rgba(0, 201, 255, 0.1); color: #00c9ff; }
        .action-delete { background: rgba(255, 50, 50, 0.1); color: #ff3232; }
        
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); z-index: 1000; align-items: center; justify-content: center; }
        .modal-content { background: var(--card-bg); border: 1px solid rgba(0, 243, 255, 0.2); border-radius: 10px; width: 90%; max-width: 500px; padding: 20px; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .modal-close { background: none; border: none; color: #a0a0a0; font-size: 1.5rem; cursor: pointer; }
        .form-group { margin-bottom: 20px; }
        .form-control { width: 100%; padding: 10px; background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(0, 243, 255, 0.2); border-radius: 4px; color: white; }
        .btn-primary { background: var(--primary-color); border: none; color: white; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-weight: 500; }
        .btn-secondary { background: rgba(0, 243, 255, 0.1); border: 1px solid rgba(0, 243, 255, 0.3); color: var(--primary-color); padding: 10px 20px; border-radius: 4px; cursor: pointer; }
        
        .grid-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-image: linear-gradient(rgba(0, 243, 255, 0.02) 1px, transparent 1px), linear-gradient(90deg, rgba(0, 243, 255, 0.02) 1px, transparent 1px); background-size: 40px 40px; pointer-events: none; z-index: -1; }
        
        @media (max-width: 992px) {
            .admin-sidebar { transform: translateX(-100%); }
            .admin-sidebar.show { transform: translateX(0); }
            .admin-main { margin-left: 0; }
            .menu-toggle { display: block; }
        }
        @media (max-width: 768px) {
            .header-actions { display: none; }
            .admin-table { display: block; overflow-x: auto; }
        }
    </style>
</head>
<body>
    <div class="grid-bg"></div>
    <div id="content-container"></div>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        let currentUser = null;
        let userChart = null;
        
        document.addEventListener('DOMContentLoaded', async () => {
            const hasAccess = await checkAdminAccess();
            if (!hasAccess) return;
            await showAdminDashboard();
        });
        
        async function checkAdminAccess() {
            const savedUser = localStorage.getItem('admin_user');
            if (!savedUser) {
                window.location.href = 'login.html';
                return false;
            }
            try {
                currentUser = JSON.parse(savedUser);
                if (currentUser.role !== 'admin' && currentUser.role !== 'moderator') {
                    window.location.href = 'profile.html';
                    return false;
                }
                return true;
            } catch {
                window.location.href = 'login.html';
                return false;
            }
        }
        
        async function showAdminDashboard() {
            document.getElementById('content-container').innerHTML = `
                <nav class="admin-sidebar" id="sidebar">
                    <div class="sidebar-header"><a href="index.html" class="sidebar-logo"><img src="logo.png" alt="Logo"><span>System_VM_D62E</span></a></div>
                    <div class="sidebar-nav">
                        <a href="#dashboard" class="nav-item active" data-section="dashboard"><i class="fas fa-home"></i><span>仪表盘</span></a>
                        <a href="#users" class="nav-item" data-section="users"><i class="fas fa-users"></i><span>用户管理</span><span class="nav-badge" id="user-count">0</span></a>
                        <a href="#analytics" class="nav-item" data-section="analytics"><i class="fas fa-chart-line"></i><span>数据分析</span></a>
                        <a href="#settings" class="nav-item" data-section="settings"><i class="fas fa-cog"></i><span>系统设置</span></a>
                        <a href="#logs" class="nav-item" data-section="logs"><i class="fas fa-history"></i><span>操作日志</span></a>
                    </div>
                    <div class="sidebar-footer">
                        <div class="user-profile">
                            <img src="logo.png" class="user-avatar" id="user-avatar">
                            <div class="user-info">
                                <div class="user-name" id="user-name">加载中...</div>
                                <div class="user-role" id="user-role">管理员</div>
                            </div>
                            <button class="logout-btn" id="logout-btn"><i class="fas fa-sign-out-alt"></i></button>
                        </div>
                    </div>
                </nav>
                <main class="admin-main">
                    <header class="admin-header">
                        <div class="header-left">
                            <button class="menu-toggle" id="menu-toggle"><i class="fas fa-bars"></i></button>
                            <h1 class="header-title" id="page-title">仪表盘</h1>
                        </div>
                        <div class="header-right">
                            <div class="header-actions">
                                <button class="action-btn" id="refresh-btn"><i class="fas fa-sync-alt"></i><span>刷新</span></button>
                                <button class="action-btn" id="create-user-btn"><i class="fas fa-plus"></i><span>新建用户</span></button>
                            </div>
                        </div>
                    </header>
                    <div class="admin-content" id="content-area">
                        <div id="dashboard-section">
                            <div class="stats-grid">
                                <div class="stat-card">
                                    <div class="stat-header"><div class="stat-title">总用户数</div><div class="stat-icon" style="background: rgba(0, 243, 255, 0.1); color: var(--primary-color);"><i class="fas fa-users"></i></div></div>
                                    <div class="stat-value" id="stat-total-users">0</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-header"><div class="stat-title">今日注册</div><div class="stat-icon" style="background: rgba(0, 255, 128, 0.1); color: #00ff80;"><i class="fas fa-user-plus"></i></div></div>
                                    <div class="stat-value" id="stat-today-registrations">0</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-header"><div class="stat-title">活跃用户</div><div class="stat-icon" style="background: rgba(255, 165, 0, 0.1); color: #ffa500;"><i class="fas fa-chart-line"></i></div></div>
                                    <div class="stat-value" id="stat-active-users">0</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-header"><div class="stat-title">系统负载</div><div class="stat-icon" style="background: rgba(148, 0, 211, 0.1); color: #9400d3;"><i class="fas fa-server"></i></div></div>
                                    <div class="stat-value" id="stat-system-load">0%</div>
                                </div>
                            </div>
                            <div class="chart-container">
                                <div class="chart-header">
                                    <div class="chart-title">用户增长趋势</div>
                                    <select class="chart-select" id="chart-period"><option value="7">最近7天</option><option value="30" selected>最近30天</option><option value="90">最近90天</option></select>
                                </div>
                                <canvas id="user-growth-chart" width="400" height="200"></canvas>
                            </div>
                            <div class="table-container">
                                <div class="table-header">
                                    <div class="table-title">最近注册用户</div>
                                    <div class="search-box"><i class="fas fa-search search-icon"></i><input type="text" class="search-input" placeholder="搜索用户..."></div>
                                </div>
                                <table class="admin-table">
                                    <thead><tr><th>用户</th><th>邮箱</th><th>角色</th><th>状态</th><th>注册时间</th><th>操作</th></tr></thead>
                                    <tbody id="recent-users-table"></tbody>
                                </table>
                            </div>
                        </div>
                        <div id="users-section" style="display: none;"></div>
                    </div>
                </main>
                <div class="modal" id="create-user-modal">
                    <div class="modal-content">
                        <div class="modal-header"><h2 class="modal-title">创建新用户</h2><button class="modal-close" id="close-create-modal">&times;</button></div>
                        <div class="modal-body">
                            <form id="create-user-form">
                                <div class="form-group"><label class="form-label">用户名</label><input type="text" class="form-control" id="new-username" required></div>
                                <div class="form-group"><label class="form-label">邮箱</label><input type="email" class="form-control" id="new-email" required></div>
                                <div class="form-group"><label class="form-label">密码</label><input type="password" class="form-control" id="new-password" required></div>
                                <div class="form-group"><label class="form-label">确认密码</label><input type="password" class="form-control" id="new-confirm-password" required></div>
                                <div class="form-group"><label class="form-label">角色</label><select class="form-control" id="new-role"><option value="user">普通用户</option><option value="moderator">版主</option><option value="admin">管理员</option></select></div>
                                <div class="form-group"><label class="form-label">状态</label><select class="form-control" id="new-status"><option value="active">活跃</option><option value="inactive">未激活</option></select></div>
                            </form>
                        </div>
                        <div class="modal-footer"><button class="btn-secondary" id="cancel-create">取消</button><button class="btn-primary" id="submit-create">创建</button></div>
                    </div>
                </div>
            `;
            
            await loadUserProfile();
            await loadDashboardData();
            bindEvents();
            initCharts();
        }
        
        function loadUserProfile() {
            if (currentUser) {
                document.getElementById('user-name').textContent = currentUser.full_name || currentUser.username;
                document.getElementById('user-role').textContent = currentUser.role === 'admin' ? '管理员' : currentUser.role === 'moderator' ? '版主' : '用户';
            }
        }
        
        async function loadDashboardData() {
            const mockStats = { total_users: 1254, today_registrations: 23, active_users: 856, system_load: '42%' };
            document.getElementById('stat-total-users').textContent = mockStats.total_users;
            document.getElementById('stat-today-registrations').textContent = mockStats.today_registrations;
            document.getElementById('stat-active-users').textContent = mockStats.active_users;
            document.getElementById('stat-system-load').textContent = mockStats.system_load;
            updateUserGrowthChart();
            await loadRecentUsers();
        }
        
        function initCharts() {
            const ctx = document.getElementById('user-growth-chart').getContext('2d');
            userChart = new Chart(ctx, {
                type: 'line',
                data: { labels: [], datasets: [{ label: '用户登录数', data: [], borderColor: 'rgba(0, 243, 255, 0.8)', backgroundColor: 'rgba(0, 243, 255, 0.1)', tension: 0.4, fill: true }] },
                options: {
                    responsive: true,
                    scales: {
                        x: { grid: { color: 'rgba(255, 255, 255, 0.1)' }, ticks: { color: '#a0a0a0' } },
                        y: { grid: { color: 'rgba(255, 255, 255, 0.1)' }, ticks: { color: '#a0a0a0' } }
                    }
                }
            });
        }
        
        function updateUserGrowthChart() {
            if (!userChart) return;
            const labels = [], data = [];
            const today = new Date();
            for (let i = 29; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                labels.push(`${date.getMonth() + 1}/${date.getDate()}`);
                data.push(Math.round(800 + Math.random() * 100 + Math.random() * 50 - 25));
            }
            userChart.data.labels = labels;
            userChart.data.datasets[0].data = data;
            userChart.update();
        }
        
        async function loadRecentUsers() {
            const mockUsers = [
                { id: 1, username: 'tech_guru', full_name: '张三', email: 'zhangsan@example.com', avatar_url: 'logo.png', role: 'user', status: 'active', created_at: '2025-01-15T10:30:00Z' },
                { id: 2, username: 'code_master', full_name: '李四', email: 'lisi@example.com', avatar_url: 'logo.png', role: 'moderator', status: 'active', created_at: '2025-01-14T14:20:00Z' },
                { id: 3, username: 'design_wizard', full_name: '王五', email: 'wangwu@example.com', avatar_url: 'logo.png', role: 'user', status: 'inactive', created_at: '2025-01-13T09:15:00Z' }
            ];
            const tbody = document.getElementById('recent-users-table');
            tbody.innerHTML = mockUsers.map(user => `
                <tr>
                    <td><div class="user-cell"><img src="${user.avatar_url}" class="user-avatar-sm"><div><div style="font-weight: 500;">${user.username}</div><div style="font-size: 0.8rem; color: #a0a0a0;">${user.full_name}</div></div></div></td>
                    <td>${user.email}</td>
                    <td><span class="role-badge">${user.role === 'admin' ? '管理员' : user.role === 'moderator' ? '版主' : '用户'}</span></td>
                    <td><span class="status-badge ${user.status === 'active' ? 'status-active' : 'status-inactive'}">${user.status === 'active' ? '活跃' : '未激活'}</span></td>
                    <td>${new Date(user.created_at).toLocaleDateString()}</td>
                    <td><div class="table-actions-cell"><div class="action-icon action-edit" data-user-id="${user.id}" title="编辑"><i class="fas fa-edit"></i></div><div class="action-icon action-delete" data-user-id="${user.id}" title="删除"><i class="fas fa-trash"></i></div></div></td>
                </tr>
            `).join('');
            document.getElementById('user-count').textContent = mockUsers.length;
            bindUserActions();
        }
        
        function bindEvents() {
            document.getElementById('menu-toggle').addEventListener('click', () => document.getElementById('sidebar').classList.toggle('show'));
            document.querySelectorAll('.nav-item').forEach(item => item.addEventListener('click', function(e) {
                e.preventDefault();
                document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                this.classList.add('active');
                switchSection(this.dataset.section);
            }));
            document.getElementById('refresh-btn').addEventListener('click', async () => await loadDashboardData());
            document.getElementById('create-user-btn').addEventListener('click', () => showModal('create-user-modal'));
            document.getElementById('close-create-modal').addEventListener('click', () => hideModal('create-user-modal'));
            document.getElementById('cancel-create').addEventListener('click', () => { hideModal('create-user-modal'); document.getElementById('create-user-form').reset(); });
            document.getElementById('submit-create').addEventListener('click', createNewUser);
            document.getElementById('logout-btn').addEventListener('click', () => { localStorage.removeItem('admin_user'); window.location.href = 'login.html'; });
            document.getElementById('chart-period').addEventListener('change', updateUserGrowthChart);
            document.querySelectorAll('.modal').forEach(modal => modal.addEventListener('click', e => { if (e.target === modal) hideModal(modal.id); }));
        }
        
        function bindUserActions() {
            document.querySelectorAll('.action-edit').forEach(btn => btn.addEventListener('click', () => alert('编辑功能开发中')));
            document.querySelectorAll('.action-delete').forEach(btn => btn.addEventListener('click', function() {
                if (confirm('确定要删除这个用户吗？此操作不可恢复。')) alert('用户删除成功');
            }));
        }
        
        function switchSection(section) {
            const titles = { 'dashboard': '仪表盘', 'users': '用户管理', 'analytics': '数据分析', 'settings': '系统设置', 'logs': '操作日志' };
            document.getElementById('page-title').textContent = titles[section] || '未知';
            document.querySelectorAll('[id$="-section"]').forEach(div => div.style.display = 'none');
            document.getElementById(`${section}-section`).style.display = 'block';
            if (section === 'users') loadUsersManagement();
        }
        
        async function loadUsersManagement() {
            document.getElementById('users-section').innerHTML = `
                <div class="table-container">
                    <div class="table-header"><div class="table-title">用户列表</div></div>
                    <table class="admin-table">
                        <thead><tr><th>用户</th><th>邮箱</th><th>角色</th><th>状态</th><th>注册时间</th><th>操作</th></tr></thead>
                        <tbody id="users-table-body"></tbody>
                    </table>
                </div>
            `;
            await loadRecentUsers();
        }
        
        async function createNewUser() {
            const form = document.getElementById('create-user-form');
            const data = {
                username: document.getElementById('new-username').value.trim(),
                email: document.getElementById('new-email').value.trim(),
                password: document.getElementById('new-password').value,
                role: document.getElementById('new-role').value,
                status: document.getElementById('new-status').value
            };
            if (!data.username || !data.email || !data.password) return alert('请填写所有必填字段');
            if (data.password.length < 8) return alert('密码长度至少8位');
            if (document.getElementById('new-confirm-password').value !== data.password) return alert('两次输入的密码不一致');
            setTimeout(() => {
                alert('用户创建成功');
                hideModal('create-user-modal');
                form.reset();
            }, 500);
        }
        
        function showModal(id) {
            document.getElementById(id).style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }
        
        function hideModal(id) {
            document.getElementById(id).style.display = 'none';
            document.body.style.overflow = '';
        }
    </script>
</body>
</html>